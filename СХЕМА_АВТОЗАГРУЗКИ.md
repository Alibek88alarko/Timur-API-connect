# 🎨 СХЕМА АВТОМАТИЧЕСКОЙ ЗАГРУЗКИ XML В KASPI

## 📊 ТЕКУЩАЯ СИТУАЦИЯ (Ручная загрузка):

```
┌──────────────┐
│  Al-Style    │  ← Твой магазин с товарами
│     API      │
└──────┬───────┘
       │
       │ HTTP GET (каждый раз вручную)
       ▼
┌──────────────┐
│   Script.py  │  ← Генерирует XML локально
│              │
└──────┬───────┘
       │
       │ Создаёт файл
       ▼
┌──────────────┐
│kaspi_price   │  ← Локальный файл на твоём ПК
│  _list.xml   │
└──────┬───────┘
       │
       │ ❌ РУЧНАЯ ЗАГРУЗКА через кабинет
       ▼
┌──────────────┐
│  Kaspi.kz    │  ← Кабинет продавца
│   Кабинет    │
└──────────────┘
```

**Проблемы:**
- ❌ Нужно вручную заходить в кабинет
- ❌ Нужно каждый раз загружать файл
- ❌ Можно забыть обновить
- ❌ Kaspi не видит твой XML автоматически

---

## 🚀 НОВАЯ СХЕМА (Автоматическая загрузка):

```
┌─────────────────────────────────────────────────────────────────┐
│                   АВТОМАТИЧЕСКИЙ ЦИКЛ                           │
│                 (БЕЗ твоего участия!)                           │
└─────────────────────────────────────────────────────────────────┘

     ┌─────────────────────────────────────────────┐
     │     РАСПИСАНИЕ (GitHub Actions)             │
     │   Каждый день: 9:00, 15:00, 21:00 UTC+3     │
     └──────────────────┬──────────────────────────┘
                        │
                        │ Запуск по расписанию
                        ▼
     ┌─────────────────────────────────────────────┐
     │        1. GitHub Actions Workflow           │
     │   (.github/workflows/kaspi_auto_update.yml) │
     └──────────────────┬──────────────────────────┘
                        │
                        │ Загружает секреты
                        │ (AL_STYLE_TOKEN, KASPI_TOKEN)
                        ▼
     ┌─────────────────────────────────────────────┐
     │         2. Al-Style API (GET)               │
     │      Получение актуальных товаров           │
     └──────────────────┬──────────────────────────┘
                        │
                        │ Возвращает JSON с товарами
                        ▼
     ┌─────────────────────────────────────────────┐
     │         3. Script.py test-xml               │
     │        Генерирует XML прайс-лист            │
     │           (250 товаров, 85 KB)              │
     └──────────────────┬──────────────────────────┘
                        │
                        │ Создаёт kaspi_price_list.xml
                        ▼
     ┌─────────────────────────────────────────────┐
     │      4. Git Commit & Push to GitHub         │
     │   git commit -m "Auto update ..."           │
     │   git push origin main                      │
     └──────────────────┬──────────────────────────┘
                        │
                        │ XML опубликован
                        ▼
     ┌─────────────────────────────────────────────┐
     │    5. GitHub Repository (публичный URL)     │
     │  https://raw.githubusercontent.com/...      │
     │         /main/kaspi_price_list.xml          │
     └──────────────────┬──────────────────────────┘
                        │
                        │ Каждые 60 минут Kaspi проверяет
                        │ (автоматически!)
                        ▼
     ┌─────────────────────────────────────────────┐
     │        6. Kaspi.kz (Автозагрузка)           │
     │   Скачивает XML если есть изменения         │
     │   Обновляет товары в каталоге               │
     └─────────────────────────────────────────────┘
                        │
                        │ Товары обновлены!
                        ▼
     ┌─────────────────────────────────────────────┐
     │    ✅ ПОКУПАТЕЛИ ВИДЯТ АКТУАЛЬНЫЕ ЦЕНЫ      │
     └─────────────────────────────────────────────┘
```

---

## 🔄 ДЕТАЛЬНАЯ СХЕМА РАБОТЫ:

### **Фаза 1: Генерация XML (GitHub Actions)**

```
┌──────────────────────────────────────────────────────────────┐
│              GitHub Actions Runner (Ubuntu)                  │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  1. Checkout Code:                                           │
│     git clone https://github.com/Alibek88alarko/...         │
│                                                              │
│  2. Setup Python 3.12:                                       │
│     python3 --version → 3.12.x                               │
│                                                              │
│  3. Install Dependencies:                                    │
│     pip install -r requirements.txt                          │
│     → requests, lxml, python-dotenv, schedule                │
│                                                              │
│  4. Create .env:                                             │
│     AL_STYLE_TOKEN=*** (из GitHub Secrets)                   │
│     KASPI_TOKEN=56Pj6wkGBX34/... (из GitHub Secrets)         │
│                                                              │
│  5. Run Script:                                              │
│     python Script.py test-xml                                │
│     ↓                                                        │
│     Получает товары из Al-Style API (HTTP 200)              │
│     Генерирует XML (250 товаров)                            │
│     Валидирует XML (✅ структура корректна)                 │
│     Сохраняет kaspi_price_list.xml (85 KB)                  │
│                                                              │
│  6. Commit & Push:                                           │
│     git add kaspi_price_list.xml                             │
│     git commit -m "Auto update 2025-10-08 09:00:00"         │
│     git push origin main                                     │
│                                                              │
│  ✅ Workflow завершён успешно!                              │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

### **Фаза 2: Публикация и доступность**

```
┌──────────────────────────────────────────────────────────────┐
│                     GitHub Repository                        │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  Репозиторий: Alibek88alarko/Timur-API-connect              │
│  Ветка: main                                                 │
│  Файл: kaspi_price_list.xml (85 KB)                         │
│                                                              │
│  Публичный URL:                                              │
│  https://raw.githubusercontent.com/Alibek88alarko/          │
│  Timur-API-connect/main/kaspi_price_list.xml                │
│                                                              │
│  Доступ:                                                     │
│  - ✅ Публичный (без авторизации)                           │
│  - ✅ Постоянный (URL не меняется)                          │
│  - ✅ Быстрый (CDN GitHub)                                  │
│  - ✅ 24/7 (всегда доступен)                                │
│                                                              │
└──────────────────────────────────────────────────────────────┘
                         │
                         │ Каждые 60 минут
                         ▼
┌──────────────────────────────────────────────────────────────┐
│                   Kaspi.kz Автозагрузка                      │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  Настройки:                                                  │
│  - URL: https://raw.githubusercontent.com/...               │
│  - Частота: каждые 60 минут                                 │
│  - Логин/пароль: не требуется                               │
│                                                              │
│  Процесс:                                                    │
│  1. Kaspi делает HTTP GET запрос                            │
│  2. Получает XML файл (85 KB)                               │
│  3. Парсит XML                                               │
│  4. Проверяет изменения (по дате в XML)                     │
│  5. Обновляет товары в каталоге                             │
│  6. Логирует результат в История загрузок                   │
│                                                              │
│  ✅ Товары обновлены автоматически!                         │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

---

## ⏰ ВРЕМЕННАЯ ДИАГРАММА:

```
00:00 ────────────────────────────────────────────────────────
      │
06:00 │  ⚡ GitHub Actions: Генерация XML #1
      │     ↓
      │     XML опубликован на GitHub
      │     ↓
07:00 │     Kaspi проверяет URL → Обновляет товары ✅
      │
12:00 │  ⚡ GitHub Actions: Генерация XML #2
      │     ↓
      │     XML опубликован на GitHub
      │     ↓
13:00 │     Kaspi проверяет URL → Обновляет товары ✅
      │
18:00 │  ⚡ GitHub Actions: Генерация XML #3
      │     ↓
      │     XML опубликован на GitHub
      │     ↓
19:00 │     Kaspi проверяет URL → Обновляет товары ✅
      │
24:00 ────────────────────────────────────────────────────────
      
      Цикл повторяется каждый день автоматически
```

---

## 🆚 СРАВНЕНИЕ: До и После

### **ДО (Ручная загрузка):**

```
Твои действия каждый день:

1. Открыть VS Code
2. Запустить: python Script.py test-xml
3. Открыть Kaspi кабинет
4. Товары → Загрузить прайс-лист
5. Выбрать файл kaspi_price_list.xml
6. Нажать "Загрузить"
7. Ждать загрузки
8. Проверить результат

Время: ~5-10 минут КАЖДЫЙ ДЕНЬ
Риск: Можешь забыть → товары устареют
```

---

### **ПОСЛЕ (Автоматическая загрузка):**

```
Твои действия:

1. (ОДИН РАЗ) Настроить GitHub Secrets
2. (ОДИН РАЗ) Загрузить workflow на GitHub
3. (ОДИН РАЗ) Настроить автозагрузку в Kaspi

Потом:
- ✅ Ничего не делать!
- ✅ Всё работает само
- ✅ 3 раза в день обновляется

Время: ~5 минут ОДИН РАЗ (при настройке)
Риск: Нет! GitHub Actions работает 24/7
```

---

## 💾 ЧТО НУЖНО ДЛЯ РАБОТЫ:

### **Требования:**

```
┌─────────────────────────────────────┐
│ ✅ GitHub аккаунт (есть)            │
│ ✅ Репозиторий публичный (есть)     │
│ ✅ Al-Style токен (есть)            │
│ ✅ Kaspi токен (есть)               │
│ ❌ Статический IP (НЕ НУЖЕН!)       │
│ ❌ Сервер 24/7 (НЕ НУЖЕН!)          │
│ ❌ Деньги (БЕСПЛАТНО!)               │
└─────────────────────────────────────┘
```

---

## 🎯 ИТОГО:

```
╔═══════════════════════════════════════════════════════════╗
║                    ✅ РЕШЕНИЕ ГОТОВО                      ║
╠═══════════════════════════════════════════════════════════╣
║                                                           ║
║  Проблема: XML загружается вручную                        ║
║  Решение:  GitHub Actions + Kaspi автозагрузка           ║
║                                                           ║
║  Преимущества:                                            ║
║  ✅ Без статического IP                                   ║
║  ✅ Полностью бесплатно                                   ║
║  ✅ Работает 24/7                                         ║
║  ✅ Автообновление 3 раза в день                          ║
║  ✅ Без твоего участия                                    ║
║                                                           ║
║  Настройка: ~5 минут (один раз)                          ║
║  Поддержка: Не требуется                                  ║
║                                                           ║
╚═══════════════════════════════════════════════════════════╝
```

---

**Следующий шаг:** Открой `БЫСТРЫЙ_СТАРТ_АВТОЗАГРУЗКА.md` и следуй инструкциям! 🚀
