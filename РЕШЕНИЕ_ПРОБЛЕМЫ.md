# üéâ –†–ï–®–ï–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´ KASPI API

**–î–∞—Ç–∞:** 8 –æ–∫—Ç—è–±—Ä—è 2025  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–†–ï–®–ï–ù–û**

---

## üî¥ –ü–†–û–ë–õ–ï–ú–ê

–ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Kaspi.kz Shop API –≤–æ–∑–Ω–∏–∫–∞–ª–∏ —Å–ª–µ–¥—É—é—â–∏–µ –æ—à–∏–±–∫–∏:

### –í Python:
```
‚è∞ TIMEOUT - —Å–µ—Ä–≤–µ—Ä –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
requests.exceptions.ReadTimeout
```

### –í PowerShell:
```
‚ùå HTTP 400 - Bad Request
```

---

## üîç –ü–†–û–¶–ï–°–° –î–ò–ê–ì–ù–û–°–¢–ò–ö–ò

### –≠—Ç–∞–ø 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–∞
- ‚úÖ –¢–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π (Base64, 44 —Å–∏–º–≤–æ–ª–∞)
- ‚úÖ –¢–æ–∫–µ–Ω –∞–∫—Ç—É–∞–ª—å–Ω—ã–π (–ø–æ–ª—É—á–µ–Ω –∏–∑ –∫–∞–±–∏–Ω–µ—Ç–∞)
- ‚úÖ –§–æ—Ä–º–∞—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏

### –≠—Ç–∞–ø 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ endpoint'–æ–≤
- ‚úÖ URL –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π: `https://kaspi.kz/shop/api/v2/orders`
- ‚úÖ –ó–∞–≥–æ–ª–æ–≤–∫–∏ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ: `Content-Type`, `X-Auth-Token`
- ‚úÖ –ü–∞—Ä–∞–º–µ—Ç—Ä—ã `page[number]` –∏ `page[size]` –¥–æ–±–∞–≤–ª–µ–Ω—ã

### –≠—Ç–∞–ø 3: –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

#### –ü—Ä–æ–±–ª–µ–º–∞ #1: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ User-Agent
```python
# –ë–ï–ó User-Agent
response = requests.get(url, headers={'X-Auth-Token': token})
# –†–µ–∑—É–ª—å—Ç–∞—Ç: TIMEOUT (Python –±–ª–æ–∫–∏—Ä—É–µ—Ç—Å—è Kaspi)
```

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å User-Agent –±—Ä–∞—É–∑–µ—Ä–∞
```python
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
    'X-Auth-Token': token
}
# –†–µ–∑—É–ª—å—Ç–∞—Ç: HTTP 400 (–Ω–æ —É–∂–µ –µ—Å—Ç—å –æ—Ç–≤–µ—Ç!)
```

#### –ü—Ä–æ–±–ª–µ–º–∞ #2: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–∞—Ç
```json
{
  "errors": [{
    "title": "Required filter [orders][creationDate][$ge] is empty."
  }]
}
```

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–∞—Ç
```python
timestamp_now = int(time.time() * 1000)
timestamp_past = timestamp_now - (14 * 24 * 60 * 60 * 1000)

params = {
    'filter[orders][creationDate][$ge]': str(timestamp_past),
    'filter[orders][creationDate][$le]': str(timestamp_now)
}
```

#### –ü—Ä–æ–±–ª–µ–º–∞ #3: –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –¥–∏–∞–ø–∞–∑–æ–Ω–∞ –¥–∞—Ç
```json
{
  "errors": [{
    "title": "Exceeded the maximum difference for the filter[orders][creationDate] (in days). Actual [30], max [14]."
  }]
}
```

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞–∫—Å–∏–º—É–º 14 –¥–Ω–µ–π
```python
kaspi_date_range_days = 14  # –ù–ï –ë–û–õ–¨–®–ï!
```

---

## ‚úÖ –û–ö–û–ù–ß–ê–¢–ï–õ–¨–ù–û–ï –†–ï–®–ï–ù–ò–ï

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏:
```python
KASPI_HEADERS = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
    'Content-Type': 'application/vnd.api+json',
    'Accept': 'application/vnd.api+json',
    'X-Auth-Token': '–≤–∞—à_—Ç–æ–∫–µ–Ω'
}
```

### –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
```python
import time

timestamp_now = int(time.time() * 1000)
timestamp_14_days_ago = timestamp_now - (14 * 24 * 60 * 60 * 1000)

params = {
    'page[number]': '0',                                          # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
    'page[size]': '20',                                           # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û (–º–∞–∫—Å. 100)
    'filter[orders][creationDate][$ge]': str(timestamp_14_days_ago),  # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
    'filter[orders][creationDate][$le]': str(timestamp_now),          # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û
    'filter[orders][status]': 'APPROVED_BY_BANK'                  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ
}
```

### –ü–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–∏–º–µ—Ä:
```python
import requests
import time
from dotenv import load_dotenv
import os

load_dotenv()

KASPI_TOKEN = os.getenv('KASPI_TOKEN')

# –ó–∞–≥–æ–ª–æ–≤–∫–∏ —Å User-Agent
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
    'Content-Type': 'application/vnd.api+json',
    'Accept': 'application/vnd.api+json',
    'X-Auth-Token': KASPI_TOKEN
}

# –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å –¥–∞—Ç–∞–º–∏ (–º–∞–∫—Å. 14 –¥–Ω–µ–π!)
timestamp_now = int(time.time() * 1000)
timestamp_14_days_ago = timestamp_now - (14 * 24 * 60 * 60 * 1000)

params = {
    'page[number]': '0',
    'page[size]': '20',
    'filter[orders][creationDate][$ge]': str(timestamp_14_days_ago),
    'filter[orders][creationDate][$le]': str(timestamp_now)
}

# –ó–∞–ø—Ä–æ—Å
response = requests.get(
    'https://kaspi.kz/shop/api/v2/orders',
    headers=headers,
    params=params,
    timeout=30
)

print(f"HTTP {response.status_code}")  # 200 = Success!

if response.status_code == 200:
    data = response.json()
    print(f"–ó–∞–∫–∞–∑–æ–≤: {data['meta']['totalCount']}")
```

---

## üìä –†–ï–ó–£–õ–¨–¢–ê–¢

```
================================================================================
üìä –†–ï–ó–£–õ–¨–¢–ê–¢: HTTP 200
================================================================================

üéâüéâüéâ –£–°–ü–ï–•!!! üéâüéâüéâ

üì¶ –í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤: 0
üìÑ –°—Ç—Ä–∞–Ω–∏—Ü: 0
üìã –ù–∞ —ç—Ç–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ: 0

üì≠ –ó–∞–∫–∞–∑–æ–≤ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 14 –¥–Ω–µ–π –Ω–µ—Ç

================================================================================
‚úÖ –í–°–Å –†–ê–ë–û–¢–ê–ï–¢ –ò–î–ï–ê–õ–¨–ù–û!
================================================================================
```

---

## üîß –í–ù–ï–°–Å–ù–ù–´–ï –ò–ó–ú–ï–ù–ï–ù–ò–Ø –í –ö–û–î

### 1. config.py
```python
# –î–æ–±–∞–≤–ª–µ–Ω–æ:
user_agent: str = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36...'
kaspi_date_range_days: int = 14  # –ú–∞–∫—Å–∏–º—É–º 14 –¥–Ω–µ–π!

# –û–±–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≥–æ–ª–æ–≤–∫–∏:
KASPI_HEADERS = {
    'User-Agent': config.user_agent,  # –ö–†–ò–¢–ò–ß–ù–û!
    'Content-Type': 'application/vnd.api+json',
    'Accept': 'application/vnd.api+json',
    'X-Auth-Token': config.kaspi_token
}
```

### 2. Script.py
```python
# –§—É–Ω–∫—Ü–∏—è process_kaspi_orders():
# –î–æ–±–∞–≤–ª–µ–Ω–æ:
import time
timestamp_now = int(time.time() * 1000)
timestamp_past = timestamp_now - (config.kaspi_date_range_days * 24 * 60 * 60 * 1000)

params = {
    'page[number]': 0,
    'page[size]': config.kaspi_page_size,
    'filter[orders][creationDate][$ge]': str(timestamp_past),  # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
    'filter[orders][creationDate][$le]': str(timestamp_now),   # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
    'filter[orders][status]': 'APPROVED_BY_BANK',
}
```

### 3. kaspi_auto_uploader.py
- –û–±–Ω–æ–≤–ª—ë–Ω –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç Script.py
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –æ–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üìù –í–ê–ñ–ù–´–ï –í–´–í–û–î–´

### ‚ùå –ë–ï–ó User-Agent:
- Python requests ‚Üí **TIMEOUT**
- Kaspi –±–ª–æ–∫–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ User-Agent

### ‚ùå –ë–ï–ó –¥–∞—Ç:
- HTTP 400: `Required filter [orders][creationDate][$ge] is empty`
- –î–∞—Ç—ã **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´** –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–ø–∏—Å–∫–æ–≤

### ‚ùå –î–∏–∞–ø–∞–∑–æ–Ω > 14 –¥–Ω–µ–π:
- HTTP 400: `Exceeded the maximum difference... max [14]`
- **–ú–∞–∫—Å–∏–º—É–º 14 –¥–Ω–µ–π!** –ù–µ 30, –Ω–µ 7, –∞ –∏–º–µ–Ω–Ω–æ 14

### ‚úÖ –° –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
- **HTTP 200** ‚úÖ
- –î–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –í—Å–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–∞–ª—å–Ω–æ!

---

## üéì –£–†–û–ö–ò

1. **User-Agent –∫—Ä–∏—Ç–∏—á–µ–Ω** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ API –±–ª–æ–∫–∏—Ä—É—é—Ç –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –Ω–µ–≥–æ
2. **–ß–∏—Ç–∞–π—Ç–µ –æ—à–∏–±–∫–∏ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω–æ** - HTTP 400 —Å–æ–¥–µ—Ä–∂–∞–ª –ø–æ–¥—Å–∫–∞–∑–∫—É –ø—Ä–æ –¥–∞—Ç—ã
3. **–¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ –≤ PowerShell** - –ø–æ–º–æ–≥–∞–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã Python
4. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–µ –≤—Å–µ–≥–¥–∞ –ø–æ–ª–Ω–∞—è** - –ø—Ä–æ User-Agent —Ç–∞–º –Ω–µ –±—ã–ª–æ –Ω–∏ —Å–ª–æ–≤–∞
5. **14 –¥–Ω–µ–π - –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫** - —ç—Ç–æ —Å–µ—Ä—å—ë–∑–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ Kaspi

---

## üöÄ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. ‚úÖ –ö–æ–¥ –æ–±–Ω–æ–≤–ª—ë–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ
2. üìù –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤
3. üîÑ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫—É —Ç–æ–≤–∞—Ä–æ–≤
4. üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –ª–æ–≥–∏ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç –æ—à–∏–±–æ–∫

---

## üìû –ï–°–õ–ò –ü–†–û–ë–õ–ï–ú–´ –í–ï–†–ù–£–¢–°–Ø

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. User-Agent –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
2. –î–∞—Ç—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ (–º–∏–ª–ª–∏—Å–µ–∫—É–Ω–¥—ã)
3. –î–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç ‚â§ 14 –¥–Ω–µ–π
4. –¢–æ–∫–µ–Ω –∞–∫—Ç—É–∞–ª—å–Ω—ã–π (–Ω–µ –∏—Å—Ç—ë–∫)

### –û—Ç–ª–∞–¥–∫–∞:
```python
# –í—ã–≤–æ–¥–∏—Ç–µ URL –∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–µ—Ä–µ–¥ –∑–∞–ø—Ä–æ—Å–æ–º
print(f"URL: {url}")
print(f"Headers: {headers}")
print(f"Params: {params}")
```

---

**–î–∞—Ç–∞ —Ä–µ—à–µ–Ω–∏—è:** 8 –æ–∫—Ç—è–±—Ä—è 2025  
**–í—Ä–µ–º—è –ø–æ–∏—Å–∫–∞ —Ä–µ—à–µ–Ω–∏—è:** ~2 —á–∞—Å–∞  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ü–û–õ–ù–û–°–¢–¨–Æ –†–ï–®–ï–ù–û**
