#!/usr/bin/env python3
"""
–ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è XML + –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è —Ä—É—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
"""
import os
import time
import shutil
from datetime import datetime
from pathlib import Path

def create_hybrid_solution():
    """–°–æ–∑–¥–∞–µ—Ç XML —Ñ–∞–π–ª—ã –¥–ª—è —Ä—É—á–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏"""
    
    print("üîÑ –ì–∏–±—Ä–∏–¥–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è + —Ä—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞")
    print("=" * 70)
    
    # –°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É –¥–ª—è –≥–æ—Ç–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
    upload_folder = Path("ready_for_upload")
    upload_folder.mkdir(exist_ok=True)
    
    # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—à—É —Ñ—É–Ω–∫—Ü–∏—é –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ XML
    import sys
    sys.path.append('.')
    from Script import get_al_style_products, update_kaspi_prices_stock
    
    print("üì¶ –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤ –∏–∑ Al-Style...")
    products = get_al_style_products()
    
    if not products:
        print("‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–≤–∞—Ä—ã")
        return
    
    print(f"‚úÖ –ü–æ–ª—É—á–µ–Ω–æ {len(products)} —Ç–æ–≤–∞—Ä–æ–≤")
    
    # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º XML
    print("üîß –ì–µ–Ω–µ—Ä–∞—Ü–∏—è XML —Ñ–∞–π–ª–∞...")
    xml_valid = update_kaspi_prices_stock(products)
    
    if not xml_valid:
        print("‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ XML")
        return
    
    # –°–æ–∑–¥–∞–µ–º timestamp –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∏–º–µ–Ω–∏
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    
    # –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª –≤ –ø–∞–ø–∫—É –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
    original_file = "kaspi_price_list.xml"
    new_filename = f"kaspi_upload_{timestamp}.xml"
    new_filepath = upload_folder / new_filename
    
    shutil.copy2(original_file, new_filepath)
    
    # –°–æ–∑–¥–∞–µ–º –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
    instruction_file = upload_folder / f"–ò–ù–°–¢–†–£–ö–¶–ò–Ø_{timestamp}.txt"
    
    instruction_text = f"""
üéØ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ó–ê–ì–†–£–ó–ö–ï –¢–û–í–ê–†–û–í –í KASPI.KZ

üìÖ –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: {datetime.now().strftime('%d.%m.%Y %H:%M:%S')}
üì¶ –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤: {len(products)}
üìÑ –§–∞–π–ª –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏: {new_filename}

üìã –ü–û–®–ê–ì–û–í–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø:

1. üåê –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–±–∏–Ω–µ—Ç –ø—Ä–æ–¥–∞–≤—Ü–∞ Kaspi.kz
   https://kaspi.kz/merchantcabinet

2. üîê –ê–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å –≤ —Å–∏—Å—Ç–µ–º–µ

3. üìÇ –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏"

4. üì§ –ù–∞–π–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É "–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª" –∏–ª–∏ "–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª"

5. üìÅ –í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª: {new_filename}

6. ‚úÖ –ù–∞–∂–º–∏—Ç–µ "–ó–∞–≥—Ä—É–∑–∏—Ç—å" –∏–ª–∏ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"

7. ‚è≥ –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –º–∏–Ω—É—Ç)

8. üìä –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ —Ä–∞–∑–¥–µ–ª–µ —Ç–æ–≤–∞—Ä–æ–≤

‚ö†Ô∏è –í–ê–ñ–ù–û:
- –ó–∞–≥—Ä—É–∂–∞–π—Ç–µ –¢–û–õ–¨–ö–û —ç—Ç–æ—Ç —Ñ–∞–π–ª: {new_filename}
- –ù–ï –∏–∑–º–µ–Ω—è–π—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞
- –ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –æ—à–∏–±–∫–∏, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

üîÑ –î–õ–Ø –°–õ–ï–î–£–Æ–©–ï–ì–û –û–ë–ù–û–í–õ–ï–ù–ò–Ø:
- –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç —Å–Ω–æ–≤–∞: python hybrid_solution.py
- –ë—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π —Ñ–∞–π–ª —Å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏

üìû –¢–ï–•–ü–û–î–î–ï–†–ñ–ö–ê:
- Kaspi.kz: 2323
- –ü—Ä–æ–±–ª–µ–º—ã —Å —Ñ–∞–π–ª–æ–º: –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã
"""
    
    with open(instruction_file, 'w', encoding='utf-8') as f:
        f.write(instruction_text)
    
    print(f"‚úÖ –ì–æ—Ç–æ–≤–æ!")
    print(f"üìÅ –§–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –≤ –ø–∞–ø–∫–µ: {upload_folder}")
    print(f"üìÑ XML —Ñ–∞–π–ª: {new_filename}")
    print(f"üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è: –ò–ù–°–¢–†–£–ö–¶–ò–Ø_{timestamp}.txt")
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫—Ä–∞—Ç–∫—É—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
    print("\n" + "="*50)
    print("üöÄ –ë–´–°–¢–†–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø:")
    print("1. –û—Ç–∫—Ä–æ–π—Ç–µ –∫–∞–±–∏–Ω–µ—Ç –ø—Ä–æ–¥–∞–≤—Ü–∞ Kaspi.kz")
    print("2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ '–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏'")
    print(f"3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª: {new_filename}")
    print("4. –î–æ–∂–¥–∏—Ç–µ—Å—å –æ–±—Ä–∞–±–æ—Ç–∫–∏")
    print("="*50)
    
    # –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–∞–ø–∫—É –≤ –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–µ (Windows)
    if os.name == 'nt':  # Windows
        os.startfile(upload_folder)
    
    return new_filepath

if __name__ == "__main__":
    create_hybrid_solution()
